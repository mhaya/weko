{#
# This file is part of WEKO3.
# Copyright (C) 2017 National Institute of Informatics.
#
# WEKO3 is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# WEKO3 is distributed in the hope that it will be
# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with WEKO3; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#}

{%- extends "weko_theme/base.html" %}

{% block css %}
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link href="{{ url_for('static', filename='css/weko_theme/gridstack.scss') }}" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/weko_theme/gridstack-extra.scss') }}" rel="stylesheet">
{%- endblock css %}
{%- block javascript %}
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.0/jquery-ui.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.0/lodash.min.js"></script>
  <script src="{{ url_for('static', filename='js/weko_theme/gridstack.js') }}"></script>
  <script src="{{ url_for('static', filename='js/weko_theme/gridstack.jQueryUI.js') }}"></script>
{%- endblock javascript %}
{%- block page_body %}
<div class="grid-stack">
</div>
{%- endblock page_body %}
<script type="text/javascript">
    $(function () {
        // thanks to http://stackoverflow.com/a/22885503
        var waitForFinalEvent=function(){var b={};return function(c,d,a){a||(a="I am a banana!");b[a]&&clearTimeout(b[a]);b[a]=setTimeout(c,d)}}();
        var fullDateString = new Date();
        function isBreakpoint(alias) {
            return $('.device-' + alias).is(':visible');
        }
        var options = {
            float: false
        };
        $('.grid-stack').gridstack(options);
        function resizeGrid() {
            var grid = $('.grid-stack').data('gridstack');
            if (isBreakpoint('xs')) {
                $('#grid-size').text('One column mode');
            } else if (isBreakpoint('sm')) {
                grid.setGridWidth(3);
                $('#grid-size').text(3);
            } else if (isBreakpoint('md')) {
                grid.setGridWidth(6);
                $('#grid-size').text(6);
            } else if (isBreakpoint('lg')) {
                grid.setGridWidth(12);
                $('#grid-size').text(12);
            }
        };
        $(window).resize(function () {
            waitForFinalEvent(function() {
                resizeGrid();
            }, 300, fullDateString.getTime());
        });
        new function () {
            this.serializedData = [
                {x: 0, y: 0, width: 4, height: 2},
                {x: 3, y: 1, width: 4, height: 2},
                {x: 4, y: 1, width: 4, height: 1},
                {x: 2, y: 3, width: 8, height: 1},
                {x: 0, y: 4, width: 4, height: 1},
                {x: 0, y: 3, width: 4, height: 1},
                {x: 2, y: 4, width: 4, height: 1},
                {x: 2, y: 5, width: 4, height: 1},
                {x: 0, y: 6, width: 12, height: 1}
            ];
            this.grid = $('.grid-stack').data('gridstack');
            this.loadGrid = function () {
                this.grid.removeAll();
                var items = GridStackUI.Utils.sort(this.serializedData);
                _.each(items, function (node, i) {
                    this.grid.addWidget($('<div><div class="grid-stack-item-content">' + i + '</div></div>'),
                        node.x, node.y, node.width, node.height);
                }.bind(this));
                return false;
            }.bind(this);
            this.loadGrid();
            resizeGrid();
        };
    });
</script>
